import{j as t}from"./jsx-runtime.3a2d0367.js";import{r as s}from"./index.b2a7ed32.js";import{u as I}from"./utils.311eb264.js";import{u as $,L as V}from"./useLoadingPhrases.57f5e175.js";const Q=({lang:S})=>{const r=I(S),[o,B]=s.useState(null),[l,L]=s.useState(""),[i,p]=s.useState(null),[U,j]=s.useState(""),[y,E]=s.useState("encrypt"),[u,m]=s.useState(!1),[v,a]=s.useState(""),[A,g]=s.useState(!1),N=s.useRef(null),C=$(u);s.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]);const k=async e=>{const d=new TextEncoder().encode(e);return await crypto.subtle.importKey("raw",d,"PBKDF2",!1,["deriveKey"])},D=async(e,n)=>await crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),K=async()=>{if(!o||!l){a(r("components.fileEncryptor.errorFillFile"));return}if(!crypto.subtle){a(r("components.fileEncryptor.errorCryptoNotAvailable"));return}m(!0),a(""),p(null);try{const e=crypto.getRandomValues(new Uint8Array(16)),n=crypto.getRandomValues(new Uint8Array(12)),d=await o.arrayBuffer(),h=await k(l),b=await D(h,e),x=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},b,d),f=new Uint8Array(x),c=new Uint8Array(e.length+n.length+f.length);c.set(e,0),c.set(n,e.length),c.set(f,e.length+n.length);const w=new Blob([c],{type:"application/octet-stream"});p(URL.createObjectURL(w)),j(`${o.name}.enc`)}catch{a(r("components.fileEncryptor.errorEncrypt"))}finally{m(!1)}},P=async()=>{if(!o||!l){a(r("components.fileEncryptor.errorFillEncryptedFile"));return}if(!crypto.subtle){a(r("components.fileEncryptor.errorCryptoNotAvailable"));return}m(!0),a(""),p(null);try{const e=await o.arrayBuffer(),n=new Uint8Array(e),d=n.slice(0,16),h=n.slice(16,28),b=n.slice(28),x=await k(l),f=await D(x,d),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:h},f,b),w=new Blob([c],{type:"application/octet-stream"});p(URL.createObjectURL(w)),j(o.name.replace(/\.enc$/,""))}catch{a(r("components.fileEncryptor.errorDecrypt"))}finally{m(!1)}},F=e=>{e&&(B(e),p(null),a(""))},R=e=>{F(e.target.files?.[0]||null)},M=e=>{e.preventDefault(),e.stopPropagation(),g(!1),F(e.dataTransfer.files?.[0]||null)},O=e=>{e.preventDefault(),e.stopPropagation(),g(!0)},T=e=>{e.preventDefault(),e.stopPropagation(),g(!1)},G=e=>{e.preventDefault(),y==="encrypt"?K():P()};return t.jsxs("div",{className:"relative bg-white p-6 rounded-lg shadow-md dark:bg-gray-800",children:[u&&t.jsx(V,{text:C}),t.jsxs("form",{onSubmit:G,children:[t.jsx("div",{className:"mb-4",children:t.jsxs("fieldset",{className:"flex space-x-4",children:[t.jsx("legend",{className:"sr-only",children:"Modo"}),t.jsxs("div",{children:[t.jsx("input",{type:"radio",id:"encrypt",name:"mode",value:"encrypt",checked:y==="encrypt",onChange:()=>E("encrypt"),className:"h-4 w-4 text-purple-600 border-gray-300 focus:ring-purple-500 dark:border-gray-600"}),t.jsx("label",{htmlFor:"encrypt",className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:r("components.fileEncryptor.encrypt")})]}),t.jsxs("div",{children:[t.jsx("input",{type:"radio",id:"decrypt",name:"mode",value:"decrypt",checked:y==="decrypt",onChange:()=>E("decrypt"),className:"h-4 w-4 text-purple-600 border-gray-300 focus:ring-purple-500 dark:border-gray-600"}),t.jsx("label",{htmlFor:"decrypt",className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:r("components.fileEncryptor.decrypt")})]})]})}),t.jsx("input",{type:"file",onChange:R,className:"hidden",ref:N}),t.jsxs("div",{onDrop:M,onDragOver:O,onDragLeave:T,className:`flex flex-col items-center justify-center p-10 border-2 border-dashed rounded-lg transition-colors ${A?"border-purple-600 bg-purple-50 dark:bg-gray-700":"border-gray-300 dark:border-gray-600"}`,children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:r("components.fileEncryptor.dragAndDrop")}),t.jsx("button",{type:"button",onClick:()=>N.current?.click(),className:"w-auto bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors",children:r("components.fileEncryptor.selectFile")}),o&&t.jsx("p",{className:"mt-4 text-sm text-gray-700 dark:text-gray-300",children:o.name})]}),t.jsx("input",{type:"password",className:"mt-4 w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 transition-shadow dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",placeholder:r("components.fileEncryptor.passwordPlaceholder"),value:l,onChange:e=>L(e.target.value)}),t.jsx("button",{type:"submit",disabled:u||!o||!l,className:"mt-4 w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 disabled:bg-purple-300 transition-colors dark:disabled:bg-purple-800",children:r(u?"components.fileEncryptor.processing":y==="encrypt"?"components.fileEncryptor.encryptButton":"components.fileEncryptor.decryptButton")}),v&&t.jsx("p",{className:"text-red-500 mt-4 text-center",children:v}),i&&t.jsxs("div",{className:"mt-6 text-center",children:[t.jsx("h3",{className:"text-lg font-semibold dark:text-gray-200",children:r("components.fileEncryptor.result")}),t.jsx("a",{href:i,download:U,className:"mt-4 inline-block bg-blue-500 text-white font-bold py-2 px-8 rounded-md hover:bg-blue-600 transition-colors",children:r("components.fileEncryptor.download")})]})]})]})};export{Q as default};
