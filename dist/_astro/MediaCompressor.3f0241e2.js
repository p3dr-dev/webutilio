import{j as s}from"./jsx-runtime.3a2d0367.js";import{r as a}from"./index.b2a7ed32.js";import{u as Q,L as H}from"./useLoadingPhrases.57f5e175.js";import{u as J}from"./utils.311eb264.js";const X=new Worker(new URL("/assets/ffmpeg.worker-4f2ae42e.js",self.location),{type:"module"}),te=({lang:O})=>{const t=J(O),[r,b]=a.useState(null),[g,y]=a.useState(""),[p,u]=a.useState(""),[i,z]=a.useState(.7),[h,k]=a.useState(null),[j,x]=a.useState(null),[L,d]=a.useState(""),[c,m]=a.useState(!1),[I,v]=a.useState(!1),R=a.useRef(null),E=Q(c),F=a.useRef(X),[S,$]=a.useState([]);a.useEffect(()=>()=>{g&&URL.revokeObjectURL(g),p&&URL.revokeObjectURL(p)},[g,p]),a.useEffect(()=>{const e=F.current;return e.onmessage=o=>{const{type:n,data:l,progress:C,time:f,message:N,outputFileName:Y}=o.data;switch(n){case"log":$(K=>[...K,N]);break;case"progress":break;case"result":const B=new Blob([l],{type:"video/mp4"}),G=URL.createObjectURL(B);u(G),x(B.size),m(!1);break;case"error":d(N),m(!1),console.error("Worker error:",N);break;default:console.log("Message from worker:",o.data)}},e.onerror=o=>{console.error("Worker error event:",o),d(t("components.mediaCompressor.errorWorker")),m(!1)},()=>{}},[]);const w=e=>{e&&(e.type.startsWith("image/")||e.type.startsWith("video/"))?(b(e),y(URL.createObjectURL(e)),k(e.size),u(""),x(null),d("")):e?(d(t("components.mediaCompressor.errorInvalidFile")),b(null),y(""),k(null)):(b(null),y(""),k(null),d(""))},q=e=>{w(e.target.files?.[0]||null)},P=e=>{e.preventDefault(),e.stopPropagation(),v(!1),w(e.dataTransfer.files?.[0]||null)},A=e=>{e.preventDefault(),e.stopPropagation(),v(!0)},T=e=>{e.preventDefault(),e.stopPropagation(),v(!1)},U=a.useCallback(()=>{if(!r)return;m(!0),u(""),x(null);const e=new FileReader;e.onload=o=>{const n=new Image;n.onload=()=>{const l=document.createElement("canvas");l.width=n.width,l.height=n.height;const C=l.getContext("2d");if(!C){d(t("components.mediaCompressor.errorCanvas")),m(!1);return}C.drawImage(n,0,0),l.toBlob(f=>{f&&(u(URL.createObjectURL(f)),x(f.size)),m(!1)},"image/jpeg",i)},n.src=o.target?.result},e.readAsDataURL(r)},[r,i,t]),M=a.useCallback(async()=>{if(!r)return;m(!0),u(""),x(null);const e=r.name,o=`output-${r.name.split(".").slice(0,-1).join(".")}.mp4`;F.current.postMessage({type:"run",payload:{file:r,fileName:e,outputFileName:o,args:["-i",e,"-b:v",`${Math.floor(i*1e3)}k`,"-bufsize",`${Math.floor(i*1e3)}k`,"-c:v","libx264","-preset","fast","-y",o]}})},[r,i]),V=a.useCallback(async()=>{r&&(r.type.startsWith("image/")?U():r.type.startsWith("video/")?M():d(t("components.mediaCompressor.errorInvalidFile")))},[r,U,M,t]),D=e=>{if(e===null||e===0)return"0 Bytes";const o=1024,n=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(o));return parseFloat((e/Math.pow(o,l)).toFixed(2))+" "+n[l]},W=(e,o)=>o?s.jsx("video",{src:e,controls:!0,className:"mt-2 rounded-lg shadow-sm mx-auto max-h-80"}):s.jsx("img",{src:e,alt:"Media",className:"mt-2 rounded-lg shadow-sm mx-auto max-h-80"});return s.jsxs("div",{className:"relative bg-white p-6 rounded-lg shadow-md dark:bg-gray-800",children:[c&&s.jsx(H,{text:E}),c&&S.length>0&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gray-900 text-white text-xs max-h-24 overflow-y-auto rounded-b-lg",children:S.map((e,o)=>s.jsx("p",{children:e},o))}),s.jsx("input",{type:"file",accept:"image/jpeg, image/png, image/webp, video/mp4, video/webm, video/ogg",onChange:q,className:"hidden",ref:R,"aria-label":"Selecionar arquivo de mÃ­dia"}),!r&&s.jsxs("div",{onDrop:P,onDragOver:A,onDragLeave:T,className:`flex flex-col items-center justify-center p-10 border-2 border-dashed rounded-lg transition-colors ${I?"border-purple-600 bg-purple-50 dark:bg-purple-900/20":"border-gray-300 dark:border-gray-600"}`,children:[s.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:t("components.mediaCompressor.dragAndDrop")}),s.jsx("button",{onClick:()=>R.current?.click(),disabled:c,className:"w-auto bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors disabled:bg-purple-400 dark:disabled:bg-purple-800",children:t("components.mediaCompressor.selectImage")})]}),L&&s.jsx("p",{className:"text-red-500 mt-4 text-center",children:L}),r&&s.jsxs("div",{className:c?"opacity-20":"",children:[s.jsxs("div",{className:"mt-6",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("label",{htmlFor:"quality",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t("components.mediaCompressor.quality"),": ",Math.round(i*100),"%"]}),s.jsx("input",{type:"range",id:"quality",min:"0.1",max:"1",step:"0.05",value:i,onChange:e=>z(parseFloat(e.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600 dark:bg-gray-700",disabled:c})]}),s.jsx("button",{onClick:V,disabled:c,className:"w-full bg-green-500 text-white font-bold py-2 px-4 rounded-md hover:bg-green-600 transition-colors disabled:bg-green-300 dark:disabled:bg-green-800",children:r.type.startsWith("image/")?t("components.mediaCompressor.compressButton"):t("components.mediaCompressor.compressVideoButton")}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mt-6 text-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold dark:text-gray-200",children:t("components.mediaCompressor.original")}),g&&W(g,r.type.startsWith("video/")),s.jsx("p",{className:"mt-2 font-medium text-gray-700 dark:text-gray-300",children:D(h)})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold dark:text-gray-200",children:t("components.mediaCompressor.compressed")}),p?s.jsxs(s.Fragment,{children:[W(p,r.type.startsWith("video/")),s.jsxs("p",{className:"mt-2 font-bold text-green-600 dark:text-green-400",children:[D(j),h&&j&&s.jsxs("span",{className:"text-sm text-gray-500 ml-2 dark:text-gray-400",children:["(",((h-j)/h*100).toFixed(0),"% ",t("components.mediaCompressor.reduction"),")"]})]}),s.jsx("a",{href:p,download:`${t("components.mediaCompressor.downloadPrefix")}-${r.name}`,className:"mt-4 inline-block bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-600 transition-colors disabled:bg-blue-300 dark:disabled:bg-blue-800",children:t("components.mediaCompressor.download")})]}):s.jsx("div",{className:"mt-2 flex items-center justify-center h-80 bg-gray-100 rounded-lg dark:bg-gray-700",children:s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("components.mediaCompressor.waiting")})})]})]})]}),s.jsx("button",{onClick:()=>w(null),className:"w-full mt-4 text-sm text-gray-500 hover:text-purple-600 dark:text-gray-400 dark:hover:text-purple-400",children:t("components.mediaCompressor.selectAnother")})]})]})};export{te as default};
