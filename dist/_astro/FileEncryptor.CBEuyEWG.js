import{j as t}from"./jsx-runtime.D3GSbgeI.js";import{r as a}from"./index.yGrMsBkE.js";import{L as I}from"./LoadingSpinner.Dvz2bPl4.js";import{u as T}from"./utils.BtV3MdL8.js";import"./index.yBjzXJbu.js";const J=({lang:S})=>{const r=T(S),[o,B]=a.useState(null),[l,A]=a.useState(""),[w,p]=a.useState(null),[C,E]=a.useState(""),[d,j]=a.useState("encrypt"),[m,y]=a.useState(!1),[v,s]=a.useState(""),[K,f]=a.useState(!1),N=a.useRef(null),D=async e=>{const i=new TextEncoder().encode(e);return await crypto.subtle.importKey("raw",i,"PBKDF2",!1,["deriveKey"])},k=async(e,n)=>await crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),U=async()=>{if(!o||!l){s(r("components.fileEncryptor.errorFillFile"));return}if(!crypto.subtle){s(r("components.fileEncryptor.errorCryptoNotAvailable"));return}y(!0),s(""),p(null);try{const e=crypto.getRandomValues(new Uint8Array(16)),n=crypto.getRandomValues(new Uint8Array(12)),i=await o.arrayBuffer(),g=await D(l),h=await k(g,e),b=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},h,i),u=new Uint8Array(b),c=new Uint8Array(e.length+n.length+u.length);c.set(e,0),c.set(n,e.length),c.set(u,e.length+n.length);const x=new Blob([c],{type:"application/octet-stream"});p(URL.createObjectURL(x)),E(`${o.name}.enc`)}catch{s(r("components.fileEncryptor.errorEncrypt"))}finally{y(!1)}},L=async()=>{if(!o||!l){s(r("components.fileEncryptor.errorFillEncryptedFile"));return}if(!crypto.subtle){s(r("components.fileEncryptor.errorCryptoNotAvailable"));return}y(!0),s(""),p(null);try{const e=await o.arrayBuffer(),n=new Uint8Array(e),i=n.slice(0,16),g=n.slice(16,28),h=n.slice(28),b=await D(l),u=await k(b,i),c=await crypto.subtle.decrypt({name:"AES-GCM",iv:g},u,h),x=new Blob([c],{type:"application/octet-stream"});p(URL.createObjectURL(x)),E(o.name.replace(/\.enc$/,""))}catch{s(r("components.fileEncryptor.errorDecrypt"))}finally{y(!1)}},F=e=>{e&&(B(e),p(null),s(""))},P=e=>{F(e.target.files?.[0]||null)},R=e=>{e.preventDefault(),e.stopPropagation(),f(!1),F(e.dataTransfer.files?.[0]||null)},M=e=>{e.preventDefault(),e.stopPropagation(),f(!0)},O=e=>{e.preventDefault(),e.stopPropagation(),f(!1)},G=e=>{e.preventDefault(),d==="encrypt"?U():L()};return t.jsxs("div",{className:"relative bg-white p-6 rounded-lg shadow-md dark:bg-gray-800",children:[m&&t.jsx(I,{text:r("components.fileEncryptor.processing")}),t.jsxs("form",{onSubmit:G,children:[t.jsx("div",{className:"mb-4",children:t.jsxs("fieldset",{className:"flex space-x-4",children:[t.jsx("legend",{className:"sr-only",children:"Modo"}),t.jsxs("div",{children:[t.jsx("input",{type:"radio",id:"encrypt",name:"mode",value:"encrypt",checked:d==="encrypt",onChange:()=>j("encrypt"),className:"h-4 w-4 text-purple-600 border-gray-300 focus:ring-purple-500 dark:border-gray-600"}),t.jsx("label",{htmlFor:"encrypt",className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:r("components.fileEncryptor.encrypt")})]}),t.jsxs("div",{children:[t.jsx("input",{type:"radio",id:"decrypt",name:"mode",value:"decrypt",checked:d==="decrypt",onChange:()=>j("decrypt"),className:"h-4 w-4 text-purple-600 border-gray-300 focus:ring-purple-500 dark:border-gray-600"}),t.jsx("label",{htmlFor:"decrypt",className:"ml-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:r("components.fileEncryptor.decrypt")})]})]})}),t.jsx("input",{type:"file",onChange:P,className:"hidden",ref:N}),t.jsxs("div",{onDrop:R,onDragOver:M,onDragLeave:O,className:`flex flex-col items-center justify-center p-10 border-2 border-dashed rounded-lg transition-colors ${K?"border-purple-600 bg-purple-50 dark:bg-gray-700":"border-gray-300 dark:border-gray-600"}`,children:[t.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:r("components.fileEncryptor.dragAndDrop")}),t.jsx("button",{type:"button",onClick:()=>N.current?.click(),className:"w-auto bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 transition-colors",children:r("components.fileEncryptor.selectFile")}),o&&t.jsx("p",{className:"mt-4 text-sm text-gray-700 dark:text-gray-300",children:o.name})]}),t.jsx("input",{type:"password",className:"mt-4 w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 transition-shadow dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200",placeholder:r("components.fileEncryptor.passwordPlaceholder"),value:l,onChange:e=>A(e.target.value)}),t.jsx("button",{type:"submit",disabled:m||!o||!l,className:"mt-4 w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-md hover:bg-purple-700 disabled:bg-purple-300 transition-colors dark:disabled:bg-purple-800",children:r(m?"components.fileEncryptor.processing":d==="encrypt"?"components.fileEncryptor.encryptButton":"components.fileEncryptor.decryptButton")}),v&&t.jsx("p",{className:"text-red-500 mt-4 text-center",children:v}),w&&t.jsxs("div",{className:"mt-6 text-center",children:[t.jsx("h3",{className:"text-lg font-semibold dark:text-gray-200",children:r("components.fileEncryptor.result")}),t.jsx("a",{href:w,download:C,className:"mt-4 inline-block bg-blue-500 text-white font-bold py-2 px-8 rounded-md hover:bg-blue-600 transition-colors",children:r("components.fileEncryptor.download")})]})]})]})};export{J as default};
